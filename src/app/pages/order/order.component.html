<main class="order view">
  <section class="page-header">
    <div class="page-header__top">
      <h2 class="page-header__title title">Подробнее о заказе</h2>
    </div>
  </section>
  <section class="view__main">
    <div class="tw-grid tw-gap-5 tw-content-start">
      <div class="view__informate view__block">
        <h4 class="view__title title-sec">Информация</h4>
        <div class="tw-grid tw-gap-5 xl:tw-grid-cols-2">
          <div class="view__list">
            <p class="tw-flex tw-justify-between">
              <span>ID заказа:</span>
              <span>#{{data.id}}</span>
            </p>
            <p class="tw-flex tw-justify-between">
              <span>Точка отправки заказа:</span>
              <span>{{data.sendLocation}}</span>
            </p>
            <p class="tw-flex tw-justify-between">
              <span>Точка доставки заказа: </span>
              <span>{{data.cargoDeliveryLocation}}</span>
            </p>
            <p class="tw-flex tw-justify-between">
              <span>Тип груза:</span>
              <span>{{data.cargoType.name}}</span>
            </p>
            <p class="tw-flex tw-justify-between">
              <span>Тип транспорта:</span>
              <span>
                <span *ngFor="let item of data.transportTypes">{{item.name}} <br></span>
              </span>
            </p>
            <p class="tw-flex tw-justify-between">
              <span>Размер груза:</span>
              <span>Д:{{data.cargoLength}} см. Ш: {{data.cargoWidth}} см. В: {{data.cargoHeight}} см.</span>
            </p>
          </div>
          <div class="view__list">
            <p class="tw-flex tw-justify-between">
              <span>Пользователь:</span>
              <span>{{data.merchant.companyName}}</span>
            </p>
            <p class="tw-flex tw-justify-between">
              <span>Вес груза: </span>
              <span>{{data.cargoWeight}} кг.</span>
            </p>

            <p class="tw-flex tw-justify-between">
              <span>Стоимость: </span>
              <span class="tw-uppercase">
                <span *ngIf="data.offeredPrice">{{data.offeredPrice}} {{data.currency.name}}</span>
                <span *ngIf="!data.offeredPrice">Не указана</span>
              </span>
            </p>
            <p class="tw-flex tw-justify-between">
              <span>Дата оформления заказа: </span>
              <span>{{data.createdAt | formatTime: 'DD MMMM YYYY в HH:mm'}}</span>
            </p>
            <div class="tw-flex tw-justify-between">
              <p>Заказ назначен на:</p>
              <span>{{ data.sendCargoDate | formatTime: 'DD MMMM YYYY'}}</span>
            </div>
            <p class="tw-flex tw-justify-between">
              <span>Статус</span>
              <span>
                <span *ngIf="data.status == 0">Ожидающий</span>
                <span *ngIf="data.status == 1">Принято</span>
                <span *ngIf="data.status == 2">Выполнен</span>
                <span *ngIf="data.status == 3">Завершен</span>
                <span *ngIf="data.status == 4">Отменен</span>
              </span>
            </p>
          </div>
        </div>
        <div class="view__buttons">
          <ng-container>
          </ng-container>
          <button class="view__btn btn-yellow" type="button" (click)="close()">
            Закрыть
          </button>
        </div>

        <div class="offers" *ngIf="data.acceptedOrders.length">
          <h2 style="margin-bottom: 10px; font-size: 18px; font-weight: 500;">Предложение</h2>
          <table>
            <thead>
              <tr>
                <th>№</th>
                <th>Имя водителя</th>
                <th>Общая сумма</th>
                <th>Номер телефона водителя</th>
                <th>Статус</th>
                <th>Операция</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of data.acceptedOrders; let idx = index">
                <td>{{ item.user_id }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.priceorder + item.additional_price}}</td>
                <td>
                  <span *ngIf="item.status_order != 0">{{ item.phone }}</span>
                  <span *ngIf="item.status_order == 0"></span>
                </td>
                <td>
                  <span *ngIf="item.status_order == 0">Ожидающий</span>
                  <span *ngIf="item.status_order == 1">Принято</span>
                  <span *ngIf="item.status_order == 2">Выполнен</span>
                  <span *ngIf="item.status_order == 3">Завершен</span>
                </td>
                <td>

                  <button [disabled]="item.status_order != 0" class="view__btn btn-green ion-ni-margin ion-no-padding"
                    type="button" (click)="showAcceptOffer(item)">
                    Принять
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>
    <div class="order__map">
      <ya-map [center]="[data.start_lat, data.start_lng]" [zoom]="12">
        <ya-multiroute [referencePoints]="[[data.start_lat, data.start_lng], [data.finish_lat, data.finish_lng]]">
        </ya-multiroute>
      </ya-map>
    </div>
  </section>
</main>

<!-- <ng-template #dialogRef>
  <form #form="ngForm">
    <mat-card>
      <mat-card-header><span class="title">Счёт</span>
      </mat-card-header>

      <mat-card-content style="margin-top: 20px">
        <div style="display: flex;">
          <ul>
            <li><b>Услуга “Безопасная сделка”:</b></li>
            <li><b>Налог:</b></li>
            <li><b>Водителю:</b></li>
            <li><b>В итоге:</b></li>
          </ul>
          <ul>
            <li>{{serviceSafe | number}} сум</li>
            <li>{{returnTax() | number}} сум</li>
            <li>{{selectDriver.priceorder | number}} сум</li>
            <li>{{returnAmount() | number}} сум</li>
          </ul>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button [disabled]="!form.valid" style="margin-left: auto" class="btn-green" (click)="acceptOffer()">
          Подтверждаю
        </button>
      </mat-card-actions>
    </mat-card>
  </form>
</ng-template> -->

<ng-template #dialogRef>
  <form #form="ngForm">
    <mat-card>
      <mat-card-header><span class="title">Счёт</span>
      </mat-card-header>

      <mat-card-content style="margin-top: 20px">
        <div style="display: flex;">
          <ul>
            <li><b>Услуга “Безопасная сделка”:</b></li>
            <li><b>Налог:</b></li>
            <li><b>Водителю:</b></li>
            <li><b>В итоге:</b></li>
          </ul>
          <ul>
            <li>{{serviceSafe | number}} сум</li>
            <li>{{returnTax() | number}} сум</li>
            <li>{{selectDriver.priceorder | number}} сум</li>
            <li>{{returnAmount() | number}} сум</li>
          </ul>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button [disabled]="!form.valid" style="margin-left: auto" class="btn-green" (click)="acceptOffer()">
          Подтверждаю
        </button>
      </mat-card-actions>
    </mat-card>
  </form>
</ng-template>